"use strict";(self["webpackChunkthreat_dragon"]=self["webpackChunkthreat_dragon"]||[]).push([[135],{3119:function(t,e,i){i.r(e),i.d(e,{default:function(){return Rt}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"mt-5"},[e("b-row",[e("b-col",[e("td-graph")],1)],1)],1)},a=[],s=function(){var t=this,e=t._self._c;return e("div",[e("b-row",[e("b-col",{attrs:{md:"2"}},[e("div",{ref:"stencil_container"})]),e("b-col",{attrs:{md:"10"}},[e("b-row",[e("b-col",[e("h3",{staticClass:"td-graph-title"},[t._v(t._s(t.diagram.title))])]),e("b-col",{attrs:{align:"right"}},[e("td-graph-buttons",{attrs:{graph:t.graph},on:{saved:t.saved,closed:t.closed}})],1)],1),e("b-row",[e("b-col",{staticStyle:{display:"flex",width:"100vw"}},[e("div",{ref:"graph_container",staticStyle:{height:"65vh",width:"100%",flex:"1"},attrs:{id:"graph-container"}})])],1)],1)],1),e("td-graph-meta",{on:{threatSelected:t.threatSelected,threatSuggest:t.threatSuggest}}),e("div",[e("td-keyboard-shortcuts"),e("td-threat-edit-dialog",{ref:"threatEditDialog"}),e("td-threat-suggest-dialog",{ref:"threatSuggestDialog"})],1)],1)},n=[],r=i(5353),l=function(){var t=this,e=t._self._c;return e("b-btn-group",[e("td-form-button",{attrs:{onBtnClick:t.deleteSelected,icon:"trash",title:t.$t("threatmodel.buttons.delete"),text:""}}),e("td-form-button",{directives:[{name:"b-modal",rawName:"v-b-modal.shortcuts",modifiers:{shortcuts:!0}}],attrs:{onBtnClick:t.noOp,icon:"keyboard",title:t.$t("threatmodel.buttons.shortcuts"),text:""}}),e("td-form-button",{attrs:{onBtnClick:t.undo,icon:"undo",title:t.$t("threatmodel.buttons.undo"),text:""}}),e("td-form-button",{attrs:{onBtnClick:t.redo,icon:"redo",title:t.$t("threatmodel.buttons.redo"),text:""}}),e("td-form-button",{attrs:{onBtnClick:t.zoomIn,icon:"search-plus",title:t.$t("threatmodel.buttons.zoomIn"),text:""}}),e("td-form-button",{attrs:{onBtnClick:t.zoomOut,icon:"search-minus",title:t.$t("threatmodel.buttons.zoomOut"),text:""}}),e("td-form-button",{attrs:{onBtnClick:t.toggleGrid,icon:"th",title:t.$t("threatmodel.buttons.toggleGrid"),text:""}}),e("b-dropdown",{attrs:{right:"",text:t.$t("forms.export"),id:"export-graph-btn"}},[e("b-dropdown-item",{attrs:{id:"export-graph-png"},on:{click:t.exportPNG}},[t._v(" PNG ")]),e("b-dropdown-item",{attrs:{id:"export-graph-jpeg"},on:{click:t.exportJPEG}},[t._v(" JPEG ")]),e("b-dropdown-item",{attrs:{id:"export-graph-svg"},on:{click:t.exportSVG}},[t._v(" SVG ")])],1),e("td-form-button",{attrs:{onBtnClick:t.closeDiagram,icon:"times",text:t.$t("forms.close")}}),e("td-form-button",{attrs:{isPrimary:!0,onBtnClick:t.save,icon:"save",text:t.$t("forms.save")}})],1)},c=[],d=i(3995),h={name:"TdGraphButtons",components:{TdFormButton:d.A},computed:(0,r.aH)({diagram:t=>t.threatmodel.selectedDiagram}),data(){return{gridShowing:!0}},props:{graph:{required:!0}},methods:{save(){this.$emit("saved")},async closeDiagram(){this.$emit("closed")},noOp(){},undo(){this.graph.getPlugin("history").canUndo()&&this.graph.getPlugin("history").undo()},redo(){this.graph.getPlugin("history").canRedo()&&this.graph.getPlugin("history").redo()},zoomIn(){this.graph.zoom()<1?this.graph.zoom(.1):this.graph.zoom(.2),console.debug("zoom to "+this.graph.zoom())},zoomOut(){this.graph.zoom()<1?this.graph.zoom(-.1):this.graph.zoom(-.2),console.debug("zoom to "+this.graph.zoom())},deleteSelected(){this.graph.removeCells(this.graph.getSelectedCells())},toggleGrid(){this.gridShowing?(this.graph.hideGrid(),this.gridShowing=!1):(this.graph.showGrid(),this.gridShowing=!0)},exportPNG(){this.graph.exportPNG(`${this.diagram.title}.png`,{padding:50})},exportJPEG(){this.graph.exportJPEG(`${this.diagram.title}.jpeg`,{padding:50})},exportSVG(){this.graph.exportSVG(`${this.diagram.title}.svg`)}}},p=h,u=i(1656),g=(0,u.A)(p,l,c,!1,null,null,null),m=g.exports,f=function(){var t=this,e=t._self._c;return e("b-row",[e("b-col",{attrs:{md:"6"}},[e("b-card",{attrs:{header:`${t.$t("threatmodel.properties.title")}`}},[e("b-card-body",[e("td-graph-properties")],1)],1)],1),e("b-col",{attrs:{md:"6"}},[e("b-card",{attrs:{"header-tag":"header"},scopedSlots:t._u([{key:"header",fn:function(){return[t._v(" "+t._s(t.$t("threatmodel.threats"))+" "),t.cellRef?e("b-btn",{staticClass:"float-right",attrs:{disabled:t.disableNewThreat,variant:"primary",size:"sm"},on:{click:function(e){return t.newThreat()}}},[e("font-awesome-icon",{staticClass:"mr-1",attrs:{icon:"plus"}}),t._v(" "+t._s(t.$t("threats.newThreat"))+" ")],1):t._e()]},proxy:!0}])},[e("b-card-body",[t.cellRef?e("b-card-text",[e("b-row",t._l(t.threats||[],(function(i,o){return e("b-col",{key:o,attrs:{md:"4"}},[e("td-graph-threats",{attrs:{id:i.id,status:i.status,severity:i.severity,description:i.description,title:i.title,type:i.type,isai:i.isai,mitigation:i.mitigation,modelType:i.modelType,number:i.number},on:{threatSelected:t.threatSelected}})],1)})),1)],1):t._e(),t.cellRef&&t.cellRef.data?t._e():e("b-card-text",[t._v(" "+t._s(t.$t("threats.emptyThreat"))+" ")])],1)],1),t.disableNewThreat?t._e():e("a",{staticClass:"new-threat-by-type m-2",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.AddThreatByType()}}},[e("font-awesome-icon",{attrs:{icon:"plus"}}),t._v(" "+t._s(t.$t("threats.newThreatByType"))+" ")],1),t.disableNewThreat?t._e():e("a",{staticClass:"new-threat-by-type m-2",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.AddThreatByContext()}}},[e("font-awesome-icon",{attrs:{icon:"plus"}}),t._v(" "+t._s(t.$t("threats.newThreatByContext"))+" ")],1)],1)],1)},b=[],y=i(973),x=i(773),v=i(5608),w=i(3240),C=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"props-card"}},[e("b-row",{directives:[{name:"show",rawName:"v-show",value:!t.cellRef,expression:"!cellRef"}]},[e("b-col",[e("p",[t._v(t._s(t.$t("threatmodel.properties.emptyState")))])])],1),t.cellRef&&t.cellRef.data?e("b-form",[e("b-form-row",[e("b-col",{attrs:{md:"6"}},[e("b-form-group",{attrs:{id:"name-group","label-cols":"auto",label:t.cellRef.data&&"tm.Text"===t.cellRef.data.type?t.$t("threatmodel.properties.text"):t.$t("threatmodel.properties.name"),"label-for":"name"}},[e("b-form-textarea",{attrs:{id:"name",rows:"tm.Text"===t.cellRef.data.type?7:2,graphPro:""},on:{update:function(e){return t.onChangeName()}},model:{value:t.cellRef.data.name,callback:function(e){t.$set(t.cellRef.data,"name",e)},expression:"cellRef.data.name"}})],1)],1),"tm.Text"!==t.cellRef.data.type?e("b-col",{attrs:{md:"6"}},[e("b-form-group",{attrs:{id:"description-group","label-cols":"auto",label:t.$t("threatmodel.properties.description"),"label-for":"description"}},[e("b-form-textarea",{attrs:{id:"description"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.description,callback:function(e){t.$set(t.cellRef.data,"description",e)},expression:"cellRef.data.description"}})],1)],1):t._e(),t.cellRef.data.isTrustBoundary||"tm.Text"===t.cellRef.data.type||"tm.Flow"===t.cellRef.data.type?t._e():e("b-col",{attrs:{md:"6"}},[e("b-form-group",{attrs:{"label-cols":"auto",id:"outofscope-group"}},[e("b-form-checkbox",{attrs:{id:"outofscope"},on:{change:function(e){return t.onChangeScope()}},model:{value:t.cellRef.data.outOfScope,callback:function(e){t.$set(t.cellRef.data,"outOfScope",e)},expression:"cellRef.data.outOfScope"}},[t._v(t._s(t.$t("threatmodel.properties.outOfScope")))])],1)],1),"tm.Flow"===t.cellRef.data.type?e("b-col",{attrs:{md:"6"}},[e("b-form-group",{attrs:{"label-cols":"auto",id:"flowoutofscope-group"}},[e("b-form-checkbox",{attrs:{id:"flowoutofscope"},on:{change:function(e){return t.onChangeScope()}},model:{value:t.cellRef.data.outOfScope,callback:function(e){t.$set(t.cellRef.data,"outOfScope",e)},expression:"cellRef.data.outOfScope"}},[t._v(t._s(t.$t("threatmodel.properties.outOfScope")))]),e("b-form-checkbox",{attrs:{id:"bidirection"},on:{change:function(e){return t.onChangeBidirection()}},model:{value:t.cellRef.data.isBidirectional,callback:function(e){t.$set(t.cellRef.data,"isBidirectional",e)},expression:"cellRef.data.isBidirectional"}},[t._v(t._s(t.$t("threatmodel.properties.bidirection")))])],1)],1):t._e(),t.cellRef.data.isTrustBoundary||"tm.Text"===t.cellRef.data.type?t._e():e("b-col",{attrs:{md:"6"}},[e("b-form-group",{attrs:{id:"reasonoutofscope-group","label-cols":"auto",label:t.$t("threatmodel.properties.reasonOutOfScope"),"label-for":"reasonoutofscope"}},[e("b-form-textarea",{attrs:{id:"reasonoutofscope",disabled:!t.cellRef.data.outOfScope},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.reasonOutOfScope,callback:function(e){t.$set(t.cellRef.data,"reasonOutOfScope",e)},expression:"cellRef.data.reasonOutOfScope"}})],1)],1),"tm.Process"===t.cellRef.data.type?e("b-col",[e("b-form-group",{attrs:{id:"privilegelevel-group","label-cols":"auto",label:t.$t("threatmodel.properties.privilegeLevel"),"label-for":"privilegelevel"}},[e("b-form-input",{attrs:{id:"privilegelevel",type:"text"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.privilegeLevel,callback:function(e){t.$set(t.cellRef.data,"privilegeLevel",e)},expression:"cellRef.data.privilegeLevel"}})],1)],1):t._e(),"tm.Process"===t.cellRef.data.type?e("b-col",[e("b-form-group",{attrs:{"label-cols":"auto",id:"process-handles-group"}},[e("b-form-checkbox",{attrs:{id:"handlesCardPayment"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.handlesCardPayment,callback:function(e){t.$set(t.cellRef.data,"handlesCardPayment",e)},expression:"cellRef.data.handlesCardPayment"}},[t._v(t._s(t.$t("threatmodel.properties.handlesCardPayment")))]),e("b-form-checkbox",{attrs:{id:"handlesGoodsOrServices"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.handlesGoodsOrServices,callback:function(e){t.$set(t.cellRef.data,"handlesGoodsOrServices",e)},expression:"cellRef.data.handlesGoodsOrServices"}},[t._v(t._s(t.$t("threatmodel.properties.handlesGoodsOrServices")))])],1)],1):t._e(),"tm.Process"===t.cellRef.data.type?e("b-col",[e("b-form-group",{attrs:{"label-cols":"auto",id:"web-app-group"}},[e("b-form-checkbox",{attrs:{id:"isWebApplication"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.isWebApplication,callback:function(e){t.$set(t.cellRef.data,"isWebApplication",e)},expression:"cellRef.data.isWebApplication"}},[t._v(t._s(t.$t("threatmodel.properties.isWebApplication")))])],1)],1):t._e(),"tm.Store"===t.cellRef.data.type?e("b-col",[e("b-form-group",{attrs:{"label-cols":"auto",id:"isalog-group"}},[e("b-form-checkbox",{attrs:{id:"isalog"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.isALog,callback:function(e){t.$set(t.cellRef.data,"isALog",e)},expression:"cellRef.data.isALog"}},[t._v(t._s(t.$t("threatmodel.properties.isALog")))]),e("b-form-checkbox",{attrs:{id:"storesCredentials"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.storesCredentials,callback:function(e){t.$set(t.cellRef.data,"storesCredentials",e)},expression:"cellRef.data.storesCredentials"}},[t._v(t._s(t.$t("threatmodel.properties.storesCredentials")))])],1)],1):t._e(),"tm.Store"===t.cellRef.data.type?e("b-col",[e("b-form-group",{attrs:{"label-cols":"auto",id:"isEncrypted-group"}},[e("b-form-checkbox",{attrs:{id:"isEncrypted"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.isEncrypted,callback:function(e){t.$set(t.cellRef.data,"isEncrypted",e)},expression:"cellRef.data.isEncrypted"}},[t._v(t._s(t.$t("threatmodel.properties.isEncrypted")))]),e("b-form-checkbox",{attrs:{id:"isSigned"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.isSigned,callback:function(e){t.$set(t.cellRef.data,"isSigned",e)},expression:"cellRef.data.isSigned"}},[t._v(t._s(t.$t("threatmodel.properties.isSigned")))])],1)],1):t._e(),"tm.Store"===t.cellRef.data.type?e("b-col",[e("b-form-group",{attrs:{"label-cols":"auto",id:"storesInventory-group"}},[e("b-form-checkbox",{attrs:{id:"storesInventory"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.storesInventory,callback:function(e){t.$set(t.cellRef.data,"storesInventory",e)},expression:"cellRef.data.storesInventory"}},[t._v(t._s(t.$t("threatmodel.properties.storesInventory")))])],1)],1):t._e(),"tm.Actor"===t.cellRef.data.type?e("b-col",[e("b-form-group",{attrs:{"label-cols":"auto",id:"providesAuthentication-group"}},[e("b-form-checkbox",{attrs:{id:"providesAuthentication"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.providesAuthentication,callback:function(e){t.$set(t.cellRef.data,"providesAuthentication",e)},expression:"cellRef.data.providesAuthentication"}},[t._v(t._s(t.$t("threatmodel.properties.providesAuthentication")))])],1)],1):t._e(),"tm.Flow"===t.cellRef.data.type?e("b-col",[e("b-form-group",{attrs:{id:"protocol-group","label-cols":"auto",label:t.$t("threatmodel.properties.protocol"),"label-for":"protocol"}},[e("b-form-input",{attrs:{id:"protocol",type:"text"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.protocol,callback:function(e){t.$set(t.cellRef.data,"protocol",e)},expression:"cellRef.data.protocol"}})],1)],1):t._e(),"tm.Flow"===t.cellRef.data.type?e("b-col",[e("b-form-group",{attrs:{"label-cols":"auto",id:"isEncrypted-group"}},[e("b-form-checkbox",{attrs:{id:"isEncrypted"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.isEncrypted,callback:function(e){t.$set(t.cellRef.data,"isEncrypted",e)},expression:"cellRef.data.isEncrypted"}},[t._v(t._s(t.$t("threatmodel.properties.isEncrypted")))])],1)],1):t._e(),"tm.Flow"===t.cellRef.data.type?e("b-col",[e("b-form-group",{attrs:{"label-cols":"auto",id:"isPublicNetwork-group"}},[e("b-form-checkbox",{attrs:{id:"isPublicNetwork"},on:{change:function(e){return t.onChangeProperties()}},model:{value:t.cellRef.data.isPublicNetwork,callback:function(e){t.$set(t.cellRef.data,"isPublicNetwork",e)},expression:"cellRef.data.isPublicNetwork"}},[t._v(t._s(t.$t("threatmodel.properties.publicNetwork")))])],1)],1):t._e()],1)],1):t._e()],1)},S=[],T={name:"TdGraphProperties",computed:(0,r.aH)({cellRef:t=>t.cell.ref}),methods:{updateComponent(){this.$forceUpdate()},onChangeName(){v.A.updateName(this.cellRef),this.updateComponent()},onChangeBidirection(){v.A.updateProperties(this.cellRef),v.A.updateStyleAttrs(this.cellRef),this.updateComponent()},onChangeProperties(){v.A.updateProperties(this.cellRef),this.updateComponent()},onChangeScope(){document.getElementById("reasonoutofscope").disabled=!this.cellRef.data.outOfScope,v.A.updateProperties(this.cellRef),v.A.updateStyleAttrs(this.cellRef),this.updateComponent()}}},$=T,k=(0,u.A)($,C,S,!1,null,null,null),A=k.exports,O=function(){var t=this,e=t._self._c;return e("b-card",{staticClass:"threat-card"},[e("b-card-text",[e("b-row",[e("b-col",[t.number?e("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.threatSelected()}}},[t._v("#"+t._s(t.number)+" "+t._s(t.title||"Unknown Threat"))]):e("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.threatSelected()}}},[t._v(t._s(t.title||"Unknown Threat"))])])],1),e("b-row",[e("b-col",[t._v(" "+t._s(t.type)+" ")])],1),e("b-row",[e("b-col",[t.isai?e("p",[t._v(t._s(t.$t("threats.properties.isai"))+" : "+t._s(t.isai))]):t._e()])],1),e("b-row",[e("b-col",["Open"!==t.status?e("font-awesome-icon",{staticClass:"threat-icon green-icon",attrs:{icon:"check",title:t.status}}):t._e(),"Open"===t.status?e("font-awesome-icon",{staticClass:"threat-icon red-icon",attrs:{icon:"exclamation-triangle",title:t.status}}):t._e(),"High"===t.severity?e("font-awesome-icon",{staticClass:"threat-icon red-icon",attrs:{icon:"circle",title:t.severity}}):t._e(),"Medium"===t.severity?e("font-awesome-icon",{staticClass:"threat-icon yellow-icon",attrs:{icon:"circle",title:t.severity}}):t._e(),"Low"===t.severity?e("font-awesome-icon",{staticClass:"threat-icon green-icon",attrs:{icon:"circle",title:t.severity}}):t._e()],1),e("b-col",{attrs:{"align-h":"end"}},[e("b-badge",{attrs:{"v-if":!!t.modelType}},[t._v(t._s(t.modelType))])],1)],1)],1)],1)},N=[],D={name:"TdGraphThreats",props:{id:{type:String},status:{type:String},severity:{type:String},description:{type:String},title:{type:String},type:{type:String},mitigation:{type:String},modelType:{type:String},number:{type:Number},isai:{type:Boolean}},methods:{threatSelected(){this.$emit("threatSelected",this.id,"old")}}},R=D,G=(0,u.A)(R,O,N,!1,null,"40684c40",null),M=G.exports,_={name:"TdGraphMeta",computed:(0,r.aH)({cellRef:t=>t.cell.ref,threats:t=>t.cell.threats,diagram:t=>t.threatmodel.selectedDiagram,threatTop:t=>t.threatmodel.data.detail.threatTop,disableNewThreat:function(t){return!t.cell?.ref?.data||(t.cell.ref.data.outOfScope||t.cell.ref.data.isTrustBoundary||"tm.Text"===t.cell.ref.data.type)}}),components:{TdGraphProperties:A,TdGraphThreats:M},async mounted(){this.init()},methods:{init(){this.$store.dispatch(x.SS)},threatSelected(t,e){console.debug("selected threat ID: "+t),this.$emit("threatSelected",t,e)},newThreat(){const t=(0,y.N)(this.diagram.diagramType,this.cellRef.data.type,this.threatTop+1);console.debug("new threat ID: "+t.id),this.cellRef.data.threats.push(t),this.cellRef.data.hasOpenThreats=this.cellRef.data.threats.length>0,this.$store.dispatch(w.Ay.update,{threatTop:this.threatTop+1}),this.$store.dispatch(w.Ay.modified),this.$store.dispatch(x.Of,this.cellRef.data),v.A.updateStyleAttrs(this.cellRef),this.threatSelected(t.id,"new")},AddThreatByType(){this.$emit("threatSuggest","type")},AddThreatByContext(){this.$emit("threatSuggest","context")}}},E=_,P=(0,u.A)(E,f,b,!1,null,"293aaef4",null),I=P.exports,L=function(){var t=this,e=t._self._c;return e("b-modal",{attrs:{id:"shortcuts",size:"lg","ok-variant":"primary","header-bg-variant":"primary","header-text-variant":"light","ok-only":"",title:t.$t("threatmodel.shortcuts.title")}},[e("b-table",{attrs:{items:t.shortcuts}})],1)},j=[],B={name:"TdKeyboardShortcuts",data(){return{shortcuts:[{shortcut:this.$t("threatmodel.shortcuts.copy.shortcut"),action:this.$t("threatmodel.shortcuts.copy.action")},{shortcut:this.$t("threatmodel.shortcuts.paste.shortcut"),action:this.$t("threatmodel.shortcuts.paste.action")},{shortcut:this.$t("threatmodel.shortcuts.undo.shortcut"),action:this.$t("threatmodel.shortcuts.undo.action")},{shortcut:this.$t("threatmodel.shortcuts.redo.shortcut"),action:this.$t("threatmodel.shortcuts.redo.action")},{shortcut:this.$t("threatmodel.shortcuts.delete.shortcut"),action:this.$t("threatmodel.shortcuts.delete.action")},{shortcut:this.$t("threatmodel.shortcuts.pan.shortcut"),action:this.$t("threatmodel.shortcuts.pan.action")},{shortcut:this.$t("threatmodel.shortcuts.multiSelect.shortcut"),action:this.$t("threatmodel.shortcuts.multiSelect.action")},{shortcut:this.$t("threatmodel.shortcuts.zoom.shortcut"),action:this.$t("threatmodel.shortcuts.zoom.action")},{shortcut:this.$t("threatmodel.shortcuts.save.shortcut"),action:this.$t("threatmodel.shortcuts.save.action")}]}}},z=B,J=(0,u.A)(z,L,j,!1,null,null,null),W=J.exports,q=function(){var t=this,e=t._self._c;return e("div",[t.threat?e("b-modal",{ref:"editModal",attrs:{id:"threat-edit",size:"lg","ok-variant":"primary","header-bg-variant":"primary","header-text-variant":"light",title:t.modalTitle},scopedSlots:t._u([{key:"modal-footer",fn:function(){return[e("div",{staticClass:"w-100"},[t.newThreat?t._e():e("b-button",{staticClass:"float-left",attrs:{variant:"danger"},on:{click:function(e){return t.confirmDelete()}}},[t._v(" "+t._s(t.$t("forms.delete"))+" ")]),t.newThreat?e("b-button",{staticClass:"float-left",attrs:{variant:"danger"},on:{click:function(e){return t.immediateDelete()}}},[t._v(" "+t._s(t.$t("forms.remove"))+" ")]):t._e(),e("b-button",{staticClass:"float-right",attrs:{variant:"secondary"},on:{click:function(e){return t.updateThreat()}}},[t._v(" "+t._s(t.$t("forms.apply"))+" ")]),t.newThreat?t._e():e("b-button",{staticClass:"float-right mr-2",attrs:{variant:"secondary"},on:{click:function(e){return t.hideModal()}}},[t._v(" "+t._s(t.$t("forms.cancel"))+" ")])],1)]},proxy:!0}],null,!1,1622780337)},[e("b-form",[e("b-form-row",[e("b-col",[e("b-form-group",{attrs:{id:"title-group",label:t.$t("threats.properties.title"),"label-for":"title"}},[e("b-form-input",{attrs:{id:"title",type:"text",required:""},model:{value:t.threat.title,callback:function(e){t.$set(t.threat,"title",e)},expression:"threat.title"}})],1)],1)],1),e("b-form-row",[e("b-col",[e("b-form-group",{attrs:{id:"threat-type-group",label:t.$t("threats.properties.type"),"label-for":"threat-type"}},[e("b-form-select",{attrs:{id:"threat-type",options:t.threatTypes},model:{value:t.threat.type,callback:function(e){t.$set(t.threat,"type",e)},expression:"threat.type"}})],1)],1)],1),e("b-form-row",[e("b-col",{attrs:{md:"5"}},[e("b-form-group",{staticClass:"float-left",attrs:{id:"status-group",label:t.$t("threats.properties.status"),"label-for":"status"}},[e("b-form-radio-group",{attrs:{id:"status",options:t.statuses,buttons:""},model:{value:t.threat.status,callback:function(e){t.$set(t.threat,"status",e)},expression:"threat.status"}})],1)],1),e("b-col",{attrs:{md:"2"}},[e("b-form-group",{attrs:{id:"score-group",label:t.$t("threats.properties.score"),"label-for":"score"}},[e("b-form-input",{attrs:{id:"score",type:"text"},model:{value:t.threat.score,callback:function(e){t.$set(t.threat,"score",e)},expression:"threat.score"}})],1)],1),e("b-col",{attrs:{md:"5"}},[e("b-form-group",{staticClass:"float-right",attrs:{id:"priority-group",label:t.$t("threats.properties.priority"),"label-for":"priority"}},[e("b-form-radio-group",{attrs:{id:"priority",options:t.priorities,buttons:""},model:{value:t.threat.severity,callback:function(e){t.$set(t.threat,"severity",e)},expression:"threat.severity"}})],1)],1)],1),e("b-form-row",[e("b-col",[e("b-form-group",{staticClass:"float-left",attrs:{id:"is-ai",label:t.$t("threats.properties.isai"),"label-for":"isai-checkbox"}},[e("b-form-checkbox",{staticClass:"float-left",attrs:{id:"isai-checkbox",name:"isai-checkbox"},model:{value:t.threat.isai,callback:function(e){t.$set(t.threat,"isai",e)},expression:"threat.isai"}})],1)],1)],1),e("b-form-row",[e("b-col",[e("b-form-group",{attrs:{id:"description-group",label:t.$t("threats.properties.description"),"label-for":"description"}},[e("b-form-textarea",{attrs:{id:"description",rows:"5"},model:{value:t.threat.description,callback:function(e){t.$set(t.threat,"description",e)},expression:"threat.description"}})],1)],1)],1),e("b-form-row",[e("b-col",[e("b-form-group",{attrs:{id:"mitigation-group",label:t.$t("threats.properties.mitigation"),"label-for":"mitigation"}},[e("b-form-textarea",{attrs:{id:"mitigation",rows:"5"},model:{value:t.threat.mitigation,callback:function(e){t.$set(t.threat,"mitigation",e)},expression:"threat.mitigation"}})],1)],1)],1)],1)],1):t._e()],1)},F=[],H=i(7530),U={name:"TdThreatEditDialog",computed:{...(0,r.aH)({cellRef:t=>t.cell.ref,threatTop:t=>t.threatmodel.data.detail.threatTop}),threatTypes(){if(!this.cellRef||!this.threat||!this.threat.modelType)return[];const t=[],e=H.A.getThreatTypesByElement(this.threat.modelType,this.cellRef.data.type);return Object.keys(e).forEach((e=>{t.push(this.$t(e))}),this),t.includes(this.threat.type)||t.push(this.threat.type),t},statuses(){return[{value:"NotApplicable",text:this.$t("threats.status.notApplicable")},{value:"Open",text:this.$t("threats.status.open")},{value:"Mitigated",text:this.$t("threats.status.mitigated")}]},priorities(){return[{value:"TBD",text:this.$t("threats.priority.tbd")},{value:"Low",text:this.$t("threats.priority.low")},{value:"Medium",text:this.$t("threats.priority.medium")},{value:"High",text:this.$t("threats.priority.high")},{value:"Critical",text:this.$t("threats.priority.critical")}]},modalTitle(){return this.$t("threats.edit")+" #"+this.number}},data(){return{threat:{isai:null},modelTypes:["CIA","DIE","LINDDUN","PLOT4ai","STRIDE"],number:0}},methods:{editThreat(t,e){const i=this.cellRef.data.threats.find((e=>e.id===t));this.threat={...i},this.threat?(this.number=this.threat.number,this.newThreat="new"===e,this.$refs.editModal.show()):console.warn("Trying to access a non-existent threatId: "+t)},updateThreat(){const t=this.cellRef.data.threats.find((t=>t.id===this.threat.id));if(t){const e=this.cellRef.data;if(!e.threatFrequency){const t=H.A.getFrequencyMapByElement(this.threat.modelType,this.cellRef.data.type);null!==t&&(e.threatFrequency=t)}e.threatFrequency&&Object.keys(e.threatFrequency).forEach((t=>{this.$t(`threats.model.${this.threat.modelType.toLowerCase()}.${t}`)===this.threat.type&&e.threatFrequency[t]++})),t.status=this.threat.status,t.severity=this.threat.severity,t.title=this.threat.title,t.type=this.threat.type,t.description=this.threat.description,t.mitigation=this.threat.mitigation,t.modelType=this.threat.modelType,t.new=!1,t.number=this.number,t.isai=this.threat.isai,t.score=this.threat.score,this.$store.dispatch(x.Of,this.cellRef.data),this.$store.dispatch(w.Ay.modified),v.A.updateStyleAttrs(this.cellRef)}this.hideModal()},deleteThreat(){if(!this.threat.new){const t=this.cellRef.data.threatFrequency;Object.keys(t).forEach((e=>{this.$t(`threats.model.${this.threat.modelType.toLowerCase()}.${e}`)===this.threat.type&&t[e]--}))}this.cellRef.data.threats=this.cellRef.data.threats.filter((t=>t.id!==this.threat.id)),this.cellRef.data.hasOpenThreats=this.cellRef.data.threats.length>0,this.$store.dispatch(x.Of,this.cellRef.data),this.$store.dispatch(w.Ay.modified),v.A.updateStyleAttrs(this.cellRef)},hideModal(){this.$refs.editModal.hide()},async confirmDelete(){const t=await this.$bvModal.msgBoxConfirm(this.$t("threats.confirmDeleteMessage"),{title:this.$t("threats.confirmDeleteTitle"),okTitle:this.$t("forms.delete"),cancelTitle:this.$t("forms.cancel"),okVariant:"danger"});t&&(this.deleteThreat(),this.hideModal())},async immediateDelete(){this.deleteThreat(),this.hideModal()}}},V=U,Z=(0,u.A)(V,q,F,!1,null,null,null),Y=Z.exports,X=function(){var t=this,e=t._self._c;return e("div",[e("b-modal",{ref:"editModal",attrs:{id:"threat-edit",size:"lg","ok-variant":"primary","header-bg-variant":"primary","header-text-variant":"light",title:t.modalTitle},scopedSlots:t._u([{key:"modal-footer",fn:function(){return[e("div",{staticClass:"w-100"},[e("b-button",{staticClass:"float-right",attrs:{variant:"danger"},on:{click:function(e){return t.acceptSuggestion()}}},[t._v(" "+t._s(t.$t("forms.apply"))+" ")]),e("b-button",{staticClass:"float-left",attrs:{variant:"secondary"},on:{click:function(e){return t.previous()}}},[t._v(" "+t._s(t.$t("forms.previous"))+" ")]),e("b-button",{staticClass:"float-left",attrs:{variant:"danger"},on:{click:function(e){return t.next()}}},[t._v(" "+t._s(t.$t("forms.next"))+" ")]),e("b-button",{staticClass:"float-right mr-2",attrs:{variant:"secondary"},on:{click:function(e){return t.hideModal()}}},[t._v(" "+t._s(t.$t("forms.cancel"))+" ")])],1)]},proxy:!0}])},[e("b-form",[e("b-form-row",[e("b-col",[e("b-form-group",{attrs:{id:"title-group",label:t.$t("threats.properties.title"),"label-for":"title"}},[e("b-form-input",{attrs:{id:"title",type:"text",required:""},model:{value:t.threat.title,callback:function(e){t.$set(t.threat,"title",e)},expression:"threat.title"}})],1)],1)],1),e("b-form-row",[e("b-col",[e("b-form-group",{attrs:{id:"threat-type-group",label:t.$t("threats.properties.type"),"label-for":"threat-type"}},[e("b-form-select",{attrs:{id:"threat-type",options:t.types},model:{value:t.threat.type,callback:function(e){t.$set(t.threat,"type",e)},expression:"threat.type"}})],1)],1)],1),e("b-form-row",[e("b-col",{attrs:{md:"5"}},[e("b-form-group",{staticClass:"float-left",attrs:{id:"status-group",label:t.$t("threats.properties.status"),"label-for":"status"}},[e("b-form-radio-group",{attrs:{id:"status",options:t.statuses,buttons:""},model:{value:t.threat.status,callback:function(e){t.$set(t.threat,"status",e)},expression:"threat.status"}})],1)],1),e("b-col",{attrs:{md:"2"}},[e("b-form-group",{attrs:{id:"score-group",label:t.$t("threats.properties.score"),"label-for":"score"}},[e("b-form-input",{attrs:{id:"score",type:"text"},model:{value:t.threat.score,callback:function(e){t.$set(t.threat,"score",e)},expression:"threat.score"}})],1)],1),e("b-col",{attrs:{md:"5"}},[e("b-form-group",{staticClass:"float-right",attrs:{id:"priority-group",label:t.$t("threats.properties.priority"),"label-for":"priority"}},[e("b-form-radio-group",{attrs:{id:"priority",options:t.priorities,buttons:""},model:{value:t.threat.severity,callback:function(e){t.$set(t.threat,"severity",e)},expression:"threat.severity"}})],1)],1)],1),e("b-form-row",[e("b-col",[e("b-form-group",{attrs:{id:"description-group",label:t.$t("threats.properties.description"),"label-for":"description"}},[e("b-form-textarea",{attrs:{id:"description",rows:"5"},model:{value:t.threat.description,callback:function(e){t.$set(t.threat,"description",e)},expression:"threat.description"}})],1)],1)],1),e("b-form-row",[e("b-col",[e("b-form-group",{attrs:{id:"mitigation-group",label:t.$t("threats.properties.mitigation"),"label-for":"mitigation"}},[e("b-form-textarea",{attrs:{id:"mitigation",rows:"5"},model:{value:t.threat.mitigation,callback:function(e){t.$set(t.threat,"mitigation",e)},expression:"threat.mitigation"}})],1)],1)],1)],1)],1)],1)},K=[];function Q(t,e){return t.map((t=>{switch(t.type){case"threats.model.linddun.linkability":"STRIDE"===e?t.type="threats.model.stride.informationDisclosure":"CIA"===e&&(t.type="threats.model.cia.confidentiality");break;case"threats.model.linddun.identifiability":"STRIDE"===e?t.type="threats.model.stride.spoofing":"CIA"===e&&(t.type="threats.model.cia.confidentiality");break;case"threats.model.stride.repudiation":"LINDDUN"===e?t.type="threats.model.linddun.nonRepudiation":"CIA"===e&&(t.type="threats.model.cia.integrity");break;case"threats.model.linddun.detectability":"STRIDE"===e?t.type="threats.model.stride.informationDisclosure":"CIA"===e&&(t.type="threats.model.cia.confidentiality");break;case"threats.model.linddun.disclosureOfInformation":"STRIDE"===e?t.type="threats.model.stride.informationDisclosure":"CIA"===e&&(t.type="threats.model.cia.confidentiality");break;case"threats.model.linddun.unawareness":"STRIDE"===e?t.type="threats.model.stride.elevationOfPrivilege":"CIA"===e&&(t.type="threats.model.cia.integrity");break;case"threats.model.stride.tampering":"LINDDUN"===e?t.type="threats.model.linddun.nonCompliance":"CIA"===e&&(t.type="threats.model.cia.integrity");break}return t}))}const tt=(t,e)=>{const i=[],o="STRIDE"==e||"LINDDUN"==e||"CIA"==e?e:"null";return"null"===o||"tm.Actor"===t.type&&!t.providesAuthentication||"tm.Flow"===t.type&&!t.isPublicNetwork&&!t.isEncrypted?(i.push({title:"No Suggestions available",type:"",description:"No suggestions available for this context. Add one manually please",mitigation:""}),i):("tm.Actor"===t.type&&t.providesAuthentication&&(i.push({title:"CAPTCHA defeat",type:"threats.model.linddun.unawareness",description:"See OWASP Automated Threat #9:\nAutomation is used in an attempt to analyse and determination the answers to CAPTCHA tests and related puzzles",mitigation:"Defences include guarding against automation, unguessable CAPTCHA and proper enforcement of behavioral workflow"}),i.push({title:"Credential stuffing",type:"threats.model.linddun.disclosureOfInformation",description:"See OWASP Automated Threat #8:\nLists of stolen authentication credentials are tested against the application’s authentication mechanisms to identify whether users have re-used the same login credentials",mitigation:"Defences against Credential Stuffing are described in the OWASP Credential Stuffing Prevention Cheat Sheet, Multi-Factor Authentication being a primary counter-measure"})),"tm.Flow"===t.type&&t.isPublicNetwork&&!t.isEncrypted&&i.push({title:"Use encryption",type:"threats.model.linddun.disclosureOfInformation",description:"Unencrypted data sent over a public network may be intercepted and read by an attacker",mitigation:"Data should be encrypted either at the message or transport level"}),"tm.Flow"===t.type&&t.isEncrypted&&i.push({title:"Vulnerable transport protocol",type:"threats.model.linddun.disclosureOfInformation",description:"Older transport protocols are vulnerable and have known vulnerabilities",mitigation:"Use up to date cryptography and transport protocols"}),"tm.Flow"===t.type&&t.isPublicNetwork&&i.push({title:"Fingerprinting",type:"threats.model.linddun.linkability",description:"See OWASP Automated Threat #4:\nSpecific requests are sent to the application eliciting information in order to profile the application",mitigation:"Defence includes restricting what information is provided, for example version numbers and package details"}),"tm.Process"===t.type&&""!==t.privilegeLevel&&void 0!==t.privilegeLevel&&i.push({title:"Least privilege",type:"threats.model.linddun.unawareness",description:"If a process is comprimised and under control of a malicious actor, horizontal/lateral elevation of privilege can be used to comprimise other processes",mitigation:"Processes should run with least privilege that is practical, to minimise the impact of horizontal elevation of privilege"}),"tm.Process"===t.type&&i.push({title:"Expedition",type:"threats.model.stride.tampering",description:"See OWASP Automated Threat #6:\nUsing speed to violate explicit or implicit assumptions about the application’s normal use to achieve unfair individual gain",mitigation:"Defences include providing enforcement of behavioral workflow and anti-automation"}),"tm.Process"===t.type&&i.push({title:"Vulnerability scanning",type:"threats.model.linddun.disclosureOfInformation",description:"See OWASP Automated Threat #14:\nSystematic enumeration and examination in order to find weaknesses and points where a security vulnerability might exist",mitigation:"Defence includes providing anti-automation"}),"tm.Process"===t.type&&i.push({title:"Denial of Service",type:"threats.model.linddun.unawareness",description:"See OWASP Automated Threat #15:\nUsage may resemble legitimate application usage but leads to exhaustion of resources",mitigation:"Mitigation or prevention such as providing backoff, resource management and avoiding forced deadlock"}),"tm.Process"===t.type&&t.handlesCardPayment&&(i.push({title:"Carding",type:"threats.model.linddun.disclosureOfInformation",description:"See OWASP Automated Threat #1:\nLists of full credit/debit card data are tested against a merchant`s payment processes to identify valid card details",mitigation:"Defences include control of interaction frequency, enforcement of a single unique a action and preventing abuse of functionality"}),i.push({title:"Card cracking",type:"threats.model.linddun.disclosureOfInformation",description:"See OWASP Automated Threat #10:\nBrute force attack against application payment card process to identify the missing values for start date, expiry date and card security code",mitigation:"Defences include control of interaction frequency, preventing brute force attacks and anti-automation"})),"tm.Process"===t.type&&t.handlesCardPayment&&i.push({title:"Cashing out",type:"threats.model.stride.repudiation",description:"See OWASP Automated Threat #12:\nObtaining currency or higher-value merchandise via the application using stolen previously validated payment cards or account login credentials",mitigation:"Defences include control of interaction frequency, enforcement of a single unique action, anti-automation and preventing abuse of functionality"}),"tm.Process"===t.type&&t.isWebApplication&&i.push({title:"Footprinting",type:"threats.model.linddun.disclosureOfInformation",description:"See OWASP Automated Threat #18:\nInformation gathering with the objective of learning as much as possible about the composition, configuration and security mechanisms of the application",mitigation:"Defences include shutting down unnecessary services/ports and excluding information that could identify and compromise security of the organisation"}),"tm.Process"===t.type&&t.handlesGoodsOrServices&&(i.push({title:"Footprinting",type:"threats.model.linddun.unawareness",description:"See OWASP Automated Threat #5:\nMass acquisition of goods or services using the application in a manner that a normal user would be unable to undertake manually",mitigation:"Defences against this automated threat include control of interaction frequency, enforcement of a single unique a action and enforcement of behavioral workflow"}),i.push({title:"Sniping",type:"threats.model.linddun.unawareness",description:"See OWASP Automated Threat #13:\nAutomated exploitation of system latencies in the form of timing attacks",mitigation:"Defences include anti-automation and prevention of abuse of functionality"}),i.push({title:"Denial of inventory",type:"threats.model.linddun.unawareness",description:"See OWASP Automated Threat #21:\nSelection and deliberate holding of items from a limited inventory or stock such that other users are unable to buy/pay/confirm the items",mitigation:"Defences include control of interaction frequency and anti-automation"})),"tm.Store"===t.type&&(i.push({title:"Scraping",type:"threats.model.linddun.linkability",description:"See OWASP Automated Threat #11:\nCollecting accessible data and/or processed output from the application",mitigation:"Detect fake or compromised accounts, ensure information is accessible only with authentication and authorisation"}),i.push({title:"Skewing",type:"threats.model.linddun.unawareness",description:"See OWASP Automated Threat #16:\nAutomated repeated clicking or requesting or submitting content, affecting application based metrics such as counts, and measures of frequency and/or rate",mitigation:"Defences include control of interaction frequency or proper enforcement of a single unique action"}),i.push({title:"Spamming",type:"threats.model.linddun.unawareness",description:"See OWASP Automated Threat #17:\nStoring malicious such as malware, Iframe distribution, photographs & videos, advertisements, referrer spam and tracking/surveillance code",mitigation:"Defences include detecting embedded malicious code, controling interaction frequency and enforcement of a single unique action"})),"tm.Store"===t.type&&t.storesCredentials&&(i.push({title:"Credential cracking",type:"threats.model.linddun.disclosureOfInformation",description:"See OWASP Automated Threat #7:\nBrute force, dictionary and guessing attacks used against authentication processes of the application to identify valid account credentials",mitigation:"Defences include restriction of excessive authentication attempts, control of interaction frequency and enforcement of a single unique action"}),i.push({title:"Account creation",type:"threats.model.linddun.unawareness",description:"See OWASP Automated Threat #19:\nBulk account creation, and sometimes profile population, by using the application’s account signup processes",mitigation:"Defences include control of interaction frequency, enforcement of a single unique a action and enforcement of behavioral workflow"}),i.push({title:"Account aggregation",type:"threats.model.linddun.identifiability",description:"See OWASP Automated Threat #20:\nCompilation of credentials and information from multiple application accounts into another system",mitigation:"Defences include control of interaction frequency and prevention of abuse of functionality"})),"tm.Store"===t.type&&t.storesInventory&&i.push({title:"Coupon cracking",type:"threats.model.stride.tampering",description:"See OWASP Automated Threat #2:\nMass enumeration (for example coupon numbers, voucher codes, discount tokens) providing some form of user benefit within the application",mitigation:"Defences include providing anti-automation, guarding against brute force, and preventing abuse of functionality"}),"tm.Store"===t.type&&t.storesInventory&&i.push({title:"Scalping",type:"threats.model.linddun.unawareness",description:"See OWASP Automated Threat #5:\nMass acquisition of goods or services using the application in a manner that a normal user would be unable to undertake manually",mitigation:"Defences against this automated threat include control of interaction frequency, enforcement of a single unique a action and enforcement of behavioral workflow"}),"tm.Store"===t.type&&t.isEncrypted&&i.push({title:"Vulnerable encryption algorithms",type:"threats.model.linddun.disclosureOfInformation",description:"Out of date encryption algorithms are vulnerable and have known vulnerabilities",mitigation:"Use up to date cryptography for all signatures and encryption"}),"tm.Store"===t.type&&t.isSigned&&i.push({title:"Vulnerable cryptography",type:"threats.model.linddun.disclosureOfInformation",description:"Out of date cryptographic techniques are vulnerable and have known vulnerabilities",mitigation:"Use up to date cryptographic methods for checksums, signatures and certificates"}),"tm.Store"===t.type&&t.isALog&&i.push({title:"Log contains sensetive data",type:"threats.model.linddun.disclosureOfInformation",description:"Logs are read by unauthorised users or made public, sensitive data is then disclosed",mitigation:"Minimise any sensitive data contained in logs, consider encryption techniques"}),Q(i,o),i)};var et=i(4526),it={name:"TdThreatSuggest",computed:{...(0,r.aH)({cellRef:t=>t.cell.ref,modelType:t=>t.threatmodel.selectedDiagram.diagramType,threatTop:t=>t.threatmodel.data.detail.threatTop}),threatTypes(){if(!this.cellRef||!this.threat||!this.modelType)return[];const t=[],e=H.A.getThreatTypesByElement(this.modelType,this.cellRef.data.type);return Object.keys(e).forEach((e=>{t.push(this.$t(e))}),this),t},statuses(){return[{value:"NotApplicable",text:this.$t("threats.status.notApplicable")},{value:"Open",text:this.$t("threats.status.open")},{value:"Mitigated",text:this.$t("threats.status.mitigated")}]},priorities(){return[{value:"TBD",text:this.$t("threats.priority.tbd")},{value:"Low",text:this.$t("threats.priority.low")},{value:"Medium",text:this.$t("threats.priority.medium")},{value:"High",text:this.$t("threats.priority.high")},{value:"Critical",text:this.$t("threats.priority.critical")}]},modalTitle(){return this.$t("threats.newThreat")+" #"+(this.threatTop+1)}},data(){return{suggestions:[],types:[],threat:{},index:0}},methods:{showModal(t){this.index=0;const e=(0,y.N)(this.modelType,this.cellRef.data.type,this.threatTop+1);this.types=[...this.threatTypes],"type"==t?this.threatTypes.map(((t,i)=>{console.log(t),this.suggestions.push({...e}),this.suggestions[i].type=t})):this.suggestions=tt(this.cellRef.data,this.modelType).map((t=>(e.title=t.title,e.type=this.$t(t.type),this.types.includes(e.type)||""===e.type||this.types.push(e.type),e.description=t.description,e.mitigation=t.mitigation,console.log(e),{...e}))),this.suggestions.length&&(this.threat=this.suggestions[0]),this.$refs.editModal.show()},hideModal(){this.threat={},this.suggestions=[],this.types=[],this.index=0,this.$refs.editModal.hide()},next(){if(this.index++,this.index>=this.suggestions.length)return this.hideModal(),void(this.index=0);this.threat=this.suggestions[this.index]},acceptSuggestion(){const t=this.cellRef.data;if(this.threat.number=this.threatTop+1,this.threat.id=(0,et.A)(),!t.threatFrequency){const e=H.A.getFrequencyMapByElement(this.threat.modelType,this.cellRef.data.type);null!==e&&(t.threatFrequency=e)}t.threatFrequency&&Object.keys(t.threatFrequency).forEach((e=>{this.$t(`threats.model.${this.modelType.toLowerCase()}.${e}`)===this.threat.type&&this.threatTypes.includes(this.threat.type)&&t.threatFrequency[e]++})),this.threat.new=!1,this.cellRef.data.threats.push(this.threat),this.cellRef.data.hasOpenThreats=this.cellRef.data.threats.length>0,this.$store.dispatch(w.Ay.update,{threatTop:this.threatTop+1}),this.$store.dispatch(w.Ay.modified),this.$store.dispatch(x.Of,this.cellRef.data),v.A.updateStyleAttrs(this.cellRef),this.next()},previous(){this.index>0&&(this.index--,this.threat=this.suggestions[this.index])}}},ot=it,at=(0,u.A)(ot,X,K,!1,null,null,null),st=at.exports,nt=i(4023),rt=i(6346),lt=i(3527),ct=i(640),dt=i(5503);const ht=".x6-widget-dnd {\n  position: absolute;\n  top: -10000px;\n  left: -10000px;\n  z-index: 999999;\n  display: none;\n  cursor: move;\n  opacity: 0.7;\n  pointer-events: 'cursor';\n}\n.x6-widget-dnd.dragging {\n  display: inline-block;\n}\n.x6-widget-dnd.dragging * {\n  pointer-events: none !important;\n}\n.x6-widget-dnd .x6-graph {\n  background: transparent;\n  box-shadow: none;\n}\n";var pt,ut=function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(a=t[r])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};class gt extends dt.Ss{get targetScroller(){const t=this.options.target,e=t.getPlugin("scroller");return e}get targetGraph(){return this.options.target}get targetModel(){return this.targetGraph.model}get snapline(){const t=this.options.target,e=t.getPlugin("snapline");return e}constructor(t){super(),this.name="dnd",this.options=Object.assign(Object.assign({},gt.defaults),t),this.init()}init(){dt.H.ensure(this.name,ht),this.container=document.createElement("div"),dt.Jf.addClass(this.container,this.prefixClassName("widget-dnd")),this.draggingGraph=new dt.ke(Object.assign(Object.assign({},this.options.delegateGraphOptions),{container:document.createElement("div"),width:1,height:1,async:!1})),dt.Jf.append(this.container,this.draggingGraph.container)}start(t,e){const i=e;i.preventDefault(),this.targetModel.startBatch("dnd"),dt.Jf.addClass(this.container,"dragging"),dt.Jf.appendTo(this.container,this.options.draggingContainer||document.body),this.sourceNode=t,this.prepareDragging(t,i.clientX,i.clientY);const o=this.updateNodePosition(i.clientX,i.clientY);this.isSnaplineEnabled()&&(this.snapline.captureCursorOffset({e:i,node:t,cell:t,view:this.draggingView,x:o.x,y:o.y}),this.draggingNode.on("change:position",this.snap,this)),this.delegateDocumentEvents(gt.documentEvents,i.data)}isSnaplineEnabled(){return this.snapline&&this.snapline.isEnabled()}prepareDragging(t,e,i){const o=this.draggingGraph,a=o.model,s=this.options.getDragNode(t,{sourceNode:t,draggingGraph:o,targetGraph:this.targetGraph});s.position(0,0);let n=5;if(this.isSnaplineEnabled()&&(n+=this.snapline.options.tolerance||0),this.isSnaplineEnabled()||this.options.scaled){const t=this.targetGraph.transform.getScale();o.scale(t.sx,t.sy),n*=Math.max(t.sx,t.sy)}else o.scale(1,1);this.clearDragging(),a.resetCells([s]);const r=o.findViewByCell(s);r.undelegateEvents(),r.cell.off("changed"),o.fitToContent({padding:n,allowNewOrigin:"any",useCellGeometry:!1});const l=r.getBBox();this.geometryBBox=r.getBBox({useCellGeometry:!0}),this.delta=this.geometryBBox.getTopLeft().diff(l.getTopLeft()),this.draggingNode=s,this.draggingView=r,this.draggingBBox=s.getBBox(),this.padding=n,this.originOffset=this.updateGraphPosition(e,i)}updateGraphPosition(t,e){const i=document.body.scrollTop||document.documentElement.scrollTop,o=document.body.scrollLeft||document.documentElement.scrollLeft,a=this.delta,s=this.geometryBBox,n=this.padding||5,r={left:t-a.x-s.width/2-n+o,top:e-a.y-s.height/2-n+i};return this.draggingGraph&&dt.Jf.css(this.container,{left:`${r.left}px`,top:`${r.top}px`}),r}updateNodePosition(t,e){const i=this.targetGraph.clientToLocal(t,e),o=this.draggingBBox;return i.x-=o.width/2,i.y-=o.height/2,this.draggingNode.position(i.x,i.y),i}snap({cell:t,current:e,options:i}){const o=t;if(i.snapped){const t=this.draggingBBox;o.position(t.x+i.tx,t.y+i.ty,{silent:!0}),this.draggingView.translate(),o.position(e.x,e.y,{silent:!0}),this.snapOffset={x:i.tx,y:i.ty}}else this.snapOffset=null}onDragging(t){const e=this.draggingView;if(e){t.preventDefault();const i=this.normalizeEvent(t),o=i.clientX,a=i.clientY;this.updateGraphPosition(o,a);const s=this.updateNodePosition(o,a),n=this.targetGraph.options.embedding.enabled,r=(n||this.isSnaplineEnabled())&&this.isInsideValidArea({x:o,y:a});if(n){e.setEventData(i,{graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView});const t=e.getEventData(i);r?e.processEmbedding(i,t):e.clearEmbedding(t),this.candidateEmbedView=t.candidateEmbedView}this.isSnaplineEnabled()&&(r?this.snapline.snapOnMoving({e:i,view:e,x:s.x,y:s.y}):this.snapline.hide())}}onDragEnd(t){const e=this.draggingNode;if(e){const i=this.normalizeEvent(t),o=this.draggingView,a=this.draggingBBox,s=this.snapOffset;let n=a.x,r=a.y;s&&(n+=s.x,r+=s.y),e.position(n,r,{silent:!0});const l=this.drop(e,{x:i.clientX,y:i.clientY}),c=t=>{t?(this.onDropped(e),this.targetGraph.options.embedding.enabled&&o&&(o.setEventData(i,{cell:t,graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView}),o.finalizeEmbedding(i,o.getEventData(i)))):this.onDropInvalid(),this.candidateEmbedView=null,this.targetModel.stopBatch("dnd")};dt.eY.isAsync(l)?(this.undelegateDocumentEvents(),l.then(c)):c(l)}}clearDragging(){this.draggingNode&&(this.sourceNode=null,this.draggingNode.remove(),this.draggingNode=null,this.draggingView=null,this.delta=null,this.padding=null,this.snapOffset=null,this.originOffset=null,this.undelegateDocumentEvents())}onDropped(t){this.draggingNode===t&&(this.clearDragging(),dt.Jf.removeClass(this.container,"dragging"),dt.Jf.remove(this.container))}onDropInvalid(){const t=this.draggingNode;t&&this.onDropped(t)}isInsideValidArea(t){let e,i=null;const o=this.targetGraph,a=this.targetScroller;this.options.dndContainer&&(i=this.getDropArea(this.options.dndContainer));const s=i&&i.containsPoint(t);if(a)if(a.options.autoResize)e=this.getDropArea(a.container);else{const t=this.getDropArea(a.container);e=this.getDropArea(o.container).intersectsWithRect(t)}else e=this.getDropArea(o.container);return!s&&e&&e.containsPoint(t)}getDropArea(t){const e=dt.Jf.offset(t),i=document.body.scrollTop||document.documentElement.scrollTop,o=document.body.scrollLeft||document.documentElement.scrollLeft;return dt.M_.create({x:e.left+parseInt(dt.Jf.css(t,"border-left-width"),10)-o,y:e.top+parseInt(dt.Jf.css(t,"border-top-width"),10)-i,width:t.clientWidth,height:t.clientHeight})}drop(t,e){if(this.isInsideValidArea(e)){const i=this.targetGraph,o=i.model,a=i.clientToLocal(e),s=this.sourceNode,n=this.options.getDropNode(t,{sourceNode:s,draggingNode:t,targetGraph:this.targetGraph,draggingGraph:this.draggingGraph}),r=n.getBBox();a.x+=r.x-r.width/2,a.y+=r.y-r.height/2;const l=this.snapOffset?1:i.getGridSize();n.position(dt.fZ.snapToGrid(a.x,l),dt.fZ.snapToGrid(a.y,l)),n.removeZIndex();const c=this.options.validateNode,d=!c||c(n,{sourceNode:s,draggingNode:t,droppingNode:n,targetGraph:i,draggingGraph:this.draggingGraph});return"boolean"===typeof d?d?(o.addCell(n,{stencil:this.cid}),n):null:dt.eY.toDeferredBoolean(d).then((t=>t?(o.addCell(n,{stencil:this.cid}),n):null))}return null}onRemove(){this.draggingGraph&&(this.draggingGraph.view.remove(),this.draggingGraph.dispose())}dispose(){this.remove(),dt.H.clean(this.name)}}function mt(t,e={}){const i=dt.Kx.isModel(t)?t:(new dt.Kx).resetCells(t,{sort:!1,dryrun:!0}),o=i.getNodes(),a=e.columns||1,s=Math.ceil(o.length/a),n=e.dx||0,r=e.dy||0,l=!1!==e.center,c=!0===e.resizeToFit,d=e.marginX||0,h=e.marginY||0,p=[];let u=e.columnWidth;if("compact"===u)for(let y=0;y<a;y+=1){const t=pt.getNodesInColumn(o,y,a);p.push(pt.getMaxDim(t,"width")+n)}else{null!=u&&"auto"!==u||(u=pt.getMaxDim(o,"width")+n);for(let t=0;t<a;t+=1)p.push(u)}const g=pt.accumulate(p,d),m=[];let f=e.rowHeight;if("compact"===f)for(let y=0;y<s;y+=1){const t=pt.getNodesInRow(o,y,a);m.push(pt.getMaxDim(t,"height")+r)}else{null!=f&&"auto"!==f||(f=pt.getMaxDim(o,"height")+r);for(let t=0;t<s;t+=1)m.push(f)}const b=pt.accumulate(m,h);i.startBatch("layout"),o.forEach(((t,i)=>{const o=i%a,s=Math.floor(i/a),d=p[o],h=m[s];let u=0,f=0,y=t.getSize();if(c){let i=d-2*n,o=h-2*r;const a=y.height*(y.width?i/y.width:1),s=y.width*(y.height?o/y.height:1);h<a?i=s:o=a,y={width:i,height:o},t.setSize(y,e)}l&&(u=(d-y.width)/2,f=(h-y.height)/2),t.position(g[o]+n+u,b[s]+r+f,e)})),i.stopBatch("layout")}ut([dt.Ss.dispose()],gt.prototype,"dispose",null),function(t){t.defaults={getDragNode:t=>t.clone(),getDropNode:t=>t.clone()},t.documentEvents={mousemove:"onDragging",touchmove:"onDragging",mouseup:"onDragEnd",touchend:"onDragEnd",touchcancel:"onDragEnd"}}(gt||(gt={})),function(t){function e(t,e){return t.reduce(((t,i)=>Math.max(null===i||void 0===i?void 0:i.getSize()[e],t)),0)}function i(t,e,i){const o=[];for(let a=i*e,s=a+i;a<s;a+=1)t[a]&&o.push(t[a]);return o}function o(t,e,i){const o=[];for(let a=e,s=t.length;a<s;a+=i)t[a]&&o.push(t[a]);return o}function a(t,e){return t.reduce(((t,e,i)=>(t.push(t[i]+e),t)),[e||0])}t.getMaxDim=e,t.getNodesInRow=i,t.getNodesInColumn=o,t.accumulate=a}(pt||(pt={}));const ft=".x6-widget-dnd {\n  position: absolute;\n  top: -10000px;\n  left: -10000px;\n  z-index: 999999;\n  display: none;\n  cursor: move;\n  opacity: 0.7;\n  pointer-events: 'cursor';\n}\n.x6-widget-dnd.dragging {\n  display: inline-block;\n}\n.x6-widget-dnd.dragging * {\n  pointer-events: none !important;\n}\n.x6-widget-dnd .x6-graph {\n  background: transparent;\n  box-shadow: none;\n}\n.x6-widget-stencil {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n}\n.x6-widget-stencil::after {\n  position: absolute;\n  top: 0;\n  display: block;\n  width: 100%;\n  height: 20px;\n  padding: 8px 0;\n  line-height: 20px;\n  text-align: center;\n  opacity: 0;\n  transition: top 0.1s linear, opacity 0.1s linear;\n  content: ' ';\n  pointer-events: none;\n}\n.x6-widget-stencil-content {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  height: auto;\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.x6-widget-stencil .x6-node [magnet]:not([magnet='passive']) {\n  pointer-events: none;\n}\n.x6-widget-stencil-group {\n  padding: 0;\n  padding-bottom: 8px;\n  overflow: hidden;\n  user-select: none;\n}\n.x6-widget-stencil-group.collapsed {\n  height: auto;\n  padding-bottom: 0;\n}\n.x6-widget-stencil-group-title {\n  position: relative;\n  margin-top: 0;\n  margin-bottom: 0;\n  padding: 4px;\n  cursor: pointer;\n}\n.x6-widget-stencil-title,\n.x6-widget-stencil-group > .x6-widget-stencil-group-title {\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  user-select: none;\n}\n.x6-widget-stencil .unmatched {\n  opacity: 0.3;\n}\n.x6-widget-stencil .x6-node.unmatched {\n  display: none;\n}\n.x6-widget-stencil-group.unmatched {\n  display: none;\n}\n.x6-widget-stencil-search-text {\n  position: relative;\n  z-index: 1;\n  box-sizing: border-box;\n  width: 100%;\n  height: 30px;\n  max-height: 30px;\n  line-height: 30px;\n  outline: 0;\n}\n.x6-widget-stencil.not-found::after {\n  opacity: 1;\n  content: attr(data-not-found-text);\n}\n.x6-widget-stencil.not-found.searchable::after {\n  top: 30px;\n}\n.x6-widget-stencil.not-found.searchable.collapsable::after {\n  top: 50px;\n}\n.x6-widget-stencil {\n  color: #333;\n  background: #f5f5f5;\n}\n.x6-widget-stencil-content {\n  position: absolute;\n}\n.x6-widget-stencil.collapsable > .x6-widget-stencil-content {\n  top: 32px;\n}\n.x6-widget-stencil.searchable > .x6-widget-stencil-content {\n  top: 80px;\n}\n.x6-widget-stencil.not-found::after {\n  position: absolute;\n}\n.x6-widget-stencil.not-found.searchable.collapsable::after {\n  top: 80px;\n}\n.x6-widget-stencil.not-found.searchable::after {\n  top: 60px;\n}\n.x6-widget-stencil-group {\n  height: auto;\n  margin-bottom: 1px;\n  padding: 0;\n  transition: none;\n}\n.x6-widget-stencil-group .x6-graph {\n  background: transparent;\n  box-shadow: none;\n}\n.x6-widget-stencil-group.collapsed {\n  height: auto;\n  max-height: 31px;\n}\n.x6-widget-stencil-title,\n.x6-widget-stencil-group > .x6-widget-stencil-group-title {\n  position: relative;\n  left: 0;\n  box-sizing: border-box;\n  width: 100%;\n  height: 32px;\n  padding: 0 5px 0 8px;\n  color: #666;\n  font-weight: 700;\n  font-size: 12px;\n  line-height: 32px;\n  cursor: default;\n  transition: all 0.3;\n}\n.x6-widget-stencil-title:hover,\n.x6-widget-stencil-group > .x6-widget-stencil-group-title:hover {\n  color: #444;\n}\n.x6-widget-stencil-title {\n  background: #e9e9e9;\n}\n.x6-widget-stencil-group > .x6-widget-stencil-group-title {\n  background: #ededed;\n}\n.x6-widget-stencil.collapsable > .x6-widget-stencil-title,\n.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title {\n  padding-left: 32px;\n  cursor: pointer;\n}\n.x6-widget-stencil.collapsable > .x6-widget-stencil-title::before,\n.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title::before {\n  position: absolute;\n  top: 6px;\n  left: 8px;\n  display: block;\n  width: 18px;\n  height: 18px;\n  margin: 0;\n  padding: 0;\n  background-color: transparent;\n  background-repeat: no-repeat;\n  background-position: 0 0;\n  border: none;\n  content: ' ';\n}\n.x6-widget-stencil.collapsable > .x6-widget-stencil-title::before,\n.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title::before {\n  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIj48cGF0aCBkPSJNOS4zNzUuNUM0LjY4Ny41Ljg3NSA0LjMxMy44NzUgOWMwIDQuNjg4IDMuODEyIDguNSA4LjUgOC41IDQuNjg3IDAgOC41LTMuODEyIDguNS04LjUgMC00LjY4Ny0zLjgxMy04LjUtOC41LTguNXptMCAxNS44ODZDNS4zMDMgMTYuMzg2IDEuOTkgMTMuMDcyIDEuOTkgOXMzLjMxMi03LjM4NSA3LjM4NS03LjM4NVMxNi43NiA0LjkyOCAxNi43NiA5YzAgNC4wNzItMy4zMTMgNy4zODYtNy4zODUgNy4zODZ6Ii8+PHBhdGggZD0iTTEyLjc1MyA4LjQ0M0g1Ljk5N2EuNTU4LjU1OCAwIDAwMCAxLjExNmg2Ljc1NmEuNTU4LjU1OCAwIDAwMC0xLjExNnoiLz48L2c+PC9zdmc+');\n  opacity: 0.4;\n  transition: all 0.3s;\n}\n.x6-widget-stencil.collapsable > .x6-widget-stencil-title:hover::before,\n.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title:hover::before {\n  opacity: 0.6;\n}\n.x6-widget-stencil.collapsable.collapsed > .x6-widget-stencil-title::before,\n.x6-widget-stencil-group.collapsable.collapsed > .x6-widget-stencil-group-title::before {\n  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIj48cGF0aCBkPSJNOS4zNzUuNUM0LjY4Ny41Ljg3NSA0LjMxMy44NzUgOWMwIDQuNjg4IDMuODEyIDguNSA4LjUgOC41IDQuNjg3IDAgOC41LTMuODEyIDguNS04LjUgMC00LjY4Ny0zLjgxMy04LjUtOC41LTguNXptMCAxNS44ODZDNS4zMDMgMTYuMzg2IDEuOTkgMTMuMDcyIDEuOTkgOXMzLjMxMi03LjM4NSA3LjM4NS03LjM4NVMxNi43NiA0LjkyOCAxNi43NiA5YzAgNC4wNzItMy4zMTMgNy4zODYtNy4zODUgNy4zODZ6Ii8+PHBhdGggZD0iTTEyLjc1MyA4LjQ0M0g1Ljk5N2EuNTU4LjU1OCAwIDAwMCAxLjExNmg2Ljc1NmEuNTU4LjU1OCAwIDAwMC0xLjExNnoiLz48cGF0aCBkPSJNOC44MTcgNS42MjN2Ni43NTZhLjU1OC41NTggMCAwMDEuMTE2IDBWNS42MjNhLjU1OC41NTggMCAxMC0xLjExNiAweiIvPjwvZz48L3N2Zz4=');\n  opacity: 0.4;\n}\n.x6-widget-stencil.collapsable.collapsed > .x6-widget-stencil-title:hover::before,\n.x6-widget-stencil-group.collapsable.collapsed > .x6-widget-stencil-group-title:hover::before {\n  opacity: 0.6;\n}\n.x6-widget-stencil input[type='search'] {\n  appearance: textfield;\n}\n.x6-widget-stencil input[type='search']::-webkit-search-cancel-button,\n.x6-widget-stencil input[type='search']::-webkit-search-decoration {\n  appearance: none;\n}\n.x6-widget-stencil-search-text {\n  display: block;\n  width: 90%;\n  margin: 8px 5%;\n  padding-left: 8px;\n  color: #333;\n  background: #fff;\n  border: 1px solid #e9e9e9;\n  border-radius: 12px;\n  outline: 0;\n}\n.x6-widget-stencil-search-text:focus {\n  outline: 0;\n}\n.x6-widget-stencil::after {\n  color: #808080;\n  font-weight: 600;\n  font-size: 12px;\n  background: 0 0;\n}\n";var bt,yt,xt=function(t,e,i,o){var a,s=arguments.length,n=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)n=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(a=t[r])&&(n=(s<3?a(n):s>3?a(e,i,n):a(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n};class vt extends dt.Ss{get targetScroller(){const t=this.options.target,e=t.getPlugin("scroller");return e}get targetGraph(){return this.options.target}get targetModel(){return this.targetGraph.model}constructor(t={}){super(),this.name="stencil",dt.H.ensure(this.name,ft),this.graphs={},this.groups={},this.options=Object.assign(Object.assign({},vt.defaultOptions),t),this.init()}init(){this.dnd=new gt(this.options),this.onSearch=dt.eY.debounce(this.onSearch,200),this.initContainer(),this.initSearch(),this.initContent(),this.initGroups(),this.setTitle(),this.startListening()}load(t,e){return Array.isArray(t)?this.loadGroup(t,e):this.options.groups&&Object.keys(this.options.groups).forEach((e=>{t[e]&&this.loadGroup(t[e],e)})),this}unload(t,e){return Array.isArray(t)?this.loadGroup(t,e,!0):this.options.groups&&Object.keys(this.options.groups).forEach((e=>{t[e]&&this.loadGroup(t[e],e,!0)})),this}toggleGroup(t){return this.isGroupCollapsed(t)?this.expandGroup(t):this.collapseGroup(t),this}collapseGroup(t){if(this.isGroupCollapsable(t)){const e=this.groups[t];e&&!this.isGroupCollapsed(t)&&(this.trigger("group:collapse",{name:t}),dt.Jf.addClass(e,"collapsed"))}return this}expandGroup(t){if(this.isGroupCollapsable(t)){const e=this.groups[t];e&&this.isGroupCollapsed(t)&&(this.trigger("group:expand",{name:t}),dt.Jf.removeClass(e,"collapsed"))}return this}isGroupCollapsable(t){const e=this.groups[t];return dt.Jf.hasClass(e,"collapsable")}isGroupCollapsed(t){const e=this.groups[t];return e&&dt.Jf.hasClass(e,"collapsed")}collapseGroups(){return Object.keys(this.groups).forEach((t=>this.collapseGroup(t))),this}expandGroups(){return Object.keys(this.groups).forEach((t=>this.expandGroup(t))),this}resizeGroup(t,e){const i=this.graphs[t];return i&&i.resize(e.width,e.height),this}addGroup(t){const e=Array.isArray(t)?t:[t];this.options.groups?this.options.groups.push(...e):this.options.groups=e,e.forEach((t=>this.initGroup(t)))}removeGroup(t){const e=Array.isArray(t)?t:[t];this.options.groups&&(this.options.groups=this.options.groups.filter((t=>!e.includes(t.name))),e.forEach((t=>{const e=this.graphs[t];this.unregisterGraphEvents(e),e.dispose(),delete this.graphs[t];const i=this.groups[t];dt.Jf.remove(i),delete this.groups[t]})))}initContainer(){this.container=document.createElement("div"),dt.Jf.addClass(this.container,this.prefixClassName(bt.base)),dt.Jf.attr(this.container,"data-not-found-text",this.options.notFoundText||"No matches found")}initContent(){this.content=document.createElement("div"),dt.Jf.addClass(this.content,this.prefixClassName(bt.content)),dt.Jf.appendTo(this.content,this.container)}initSearch(){this.options.search&&(dt.Jf.addClass(this.container,"searchable"),dt.Jf.append(this.container,this.renderSearch()))}initGroup(t){const e=this.options.stencilGraphOptions||{},i=document.createElement("div");dt.Jf.addClass(i,this.prefixClassName(bt.group)),dt.Jf.attr(i,"data-name",t.name),(null==t.collapsable&&this.options.collapsable||!1!==t.collapsable)&&dt.Jf.addClass(i,"collapsable"),dt.Jf.toggleClass(i,"collapsed",!0===t.collapsed);const o=document.createElement("h3");dt.Jf.addClass(o,this.prefixClassName(bt.groupTitle)),o.innerHTML=t.title||t.name;const a=document.createElement("div");dt.Jf.addClass(a,this.prefixClassName(bt.groupContent));const s=t.graphOptions,n=new dt.ke(Object.assign(Object.assign(Object.assign({},e),s),{container:document.createElement("div"),model:e.model||new dt.Kx,width:t.graphWidth||this.options.stencilGraphWidth,height:t.graphHeight||this.options.stencilGraphHeight,interacting:!1,preventDefaultBlankAction:!1}));this.registerGraphEvents(n),dt.Jf.append(a,n.container),dt.Jf.append(i,[o,a]),dt.Jf.appendTo(i,this.content),this.groups[t.name]=i,this.graphs[t.name]=n}initGroups(){if(this.clearGroups(),this.setCollapsableState(),this.options.groups&&this.options.groups.length)this.options.groups.forEach((t=>{this.initGroup(t)}));else{const t=this.options.stencilGraphOptions||{},e=new dt.ke(Object.assign(Object.assign({},t),{container:document.createElement("div"),model:t.model||new dt.Kx,width:this.options.stencilGraphWidth,height:this.options.stencilGraphHeight,interacting:!1,preventDefaultBlankAction:!1}));dt.Jf.append(this.content,e.container),this.graphs[yt.defaultGroupName]=e}}setCollapsableState(){if(this.options.collapsable=this.options.collapsable&&this.options.groups&&this.options.groups.some((t=>!1!==t.collapsable)),this.options.collapsable){dt.Jf.addClass(this.container,"collapsable");const t=this.options.groups&&this.options.groups.every((t=>t.collapsed||!1===t.collapsable));t?dt.Jf.addClass(this.container,"collapsed"):dt.Jf.removeClass(this.container,"collapsed")}else dt.Jf.removeClass(this.container,"collapsable")}setTitle(){const t=document.createElement("div");dt.Jf.addClass(t,this.prefixClassName(bt.title)),t.innerHTML=this.options.title,dt.Jf.appendTo(t,this.container)}renderSearch(){const t=document.createElement("div");dt.Jf.addClass(t,this.prefixClassName(bt.search));const e=document.createElement("input");return dt.Jf.attr(e,{type:"search",placeholder:this.options.placeholder||"Search"}),dt.Jf.addClass(e,this.prefixClassName(bt.searchText)),dt.Jf.append(t,e),t}startListening(){const t=this.prefixClassName(bt.title),e=this.prefixClassName(bt.searchText),i=this.prefixClassName(bt.groupTitle);this.delegateEvents({[`click .${t}`]:"onTitleClick",[`touchstart .${t}`]:"onTitleClick",[`click .${i}`]:"onGroupTitleClick",[`touchstart .${i}`]:"onGroupTitleClick",[`input .${e}`]:"onSearch",[`focusin .${e}`]:"onSearchFocusIn",[`focusout .${e}`]:"onSearchFocusOut"})}stopListening(){this.undelegateEvents()}registerGraphEvents(t){t.on("cell:mousedown",this.onDragStart,this)}unregisterGraphEvents(t){t.off("cell:mousedown",this.onDragStart,this)}loadGroup(t,e,i){const o=this.getModel(e);if(o){const e=t.map((t=>dt.bP.isNode(t)?t:dt.bP.create(t)));!0===i?o.removeCells(e):o.resetCells(e)}const a=this.getGroup(e);let s=this.options.stencilGraphHeight;a&&null!=a.graphHeight&&(s=a.graphHeight);const n=a&&a.layout||this.options.layout;if(n&&o&&dt.eY.call(n,this,o,a),!s){const t=this.getGraph(e);t.fitToContent({minWidth:t.options.width,gridHeight:1,padding:a&&a.graphPadding||this.options.stencilGraphPadding||10})}return this}onDragStart(t){const{e:e,node:i}=t,o=this.getGroupByNode(i);o&&!1===o.nodeMovable||this.dnd.start(i,e)}filter(t,e){const i=Object.keys(this.graphs).reduce(((i,o)=>{const a=this.graphs[o],s=o===yt.defaultGroupName?null:o,n=a.model.getNodes().filter((i=>{let o=!1;o="function"===typeof e?dt.eY.call(e,this,i,t,s,this):"boolean"===typeof e?e:this.isCellMatched(i,t,e,t.toLowerCase()!==t);const n=a.renderer.findViewByCell(i);return n&&dt.Jf.toggleClass(n.container,"unmatched",!o),o})),r=n.length>0,l=this.options,c=new dt.Kx;return c.resetCells(n),l.layout&&dt.eY.call(l.layout,this,c,this.getGroup(o)),this.groups[o]&&dt.Jf.toggleClass(this.groups[o],"unmatched",!r),a.fitToContent({gridWidth:1,gridHeight:1,padding:l.stencilGraphPadding||10}),i||r}),!1);dt.Jf.toggleClass(this.container,"not-found",!i)}isCellMatched(t,e,i,o){return!e||!i||Object.keys(i).some((a=>{if("*"===a||t.shape===a){const s=i[a];if("boolean"===typeof s)return s;const n=Array.isArray(s)?s:[s];return n.some((i=>{let a=t.getPropByPath(i);return null!=a&&(a=`${a}`,o||(a=a.toLowerCase()),a.indexOf(e)>=0)}))}return!1}))}onSearch(t){this.filter(t.target.value,this.options.search)}onSearchFocusIn(){dt.Jf.addClass(this.container,"is-focused")}onSearchFocusOut(){dt.Jf.removeClass(this.container,"is-focused")}onTitleClick(){this.options.collapsable&&(dt.Jf.toggleClass(this.container,"collapsed"),dt.Jf.hasClass(this.container,"collapsed")?this.collapseGroups():this.expandGroups())}onGroupTitleClick(t){const e=t.target.closest(`.${this.prefixClassName(bt.group)}`);e&&this.toggleGroup(dt.Jf.attr(e,"data-name")||"");const i=Object.keys(this.groups).every((t=>{const e=this.getGroup(t),i=this.groups[t];return e&&!1===e.collapsable||dt.Jf.hasClass(i,"collapsed")}));dt.Jf.toggleClass(this.container,"collapsed",i)}getModel(t){const e=this.getGraph(t);return e?e.model:null}getGraph(t){return this.graphs[t||yt.defaultGroupName]}getGroup(t){const e=this.options.groups;return null!=t&&e&&e.length?e.find((e=>e.name===t)):null}getGroupByNode(t){const e=this.options.groups;return e?e.find((e=>{const i=this.getModel(e.name);return!!i&&i.has(t.id)})):null}clearGroups(){Object.keys(this.graphs).forEach((t=>{const e=this.graphs[t];this.unregisterGraphEvents(e),e.dispose()})),Object.keys(this.groups).forEach((t=>{const e=this.groups[t];dt.Jf.remove(e)})),this.graphs={},this.groups={}}onRemove(){this.clearGroups(),this.dnd.remove(),this.stopListening(),this.undelegateDocumentEvents()}dispose(){this.remove(),dt.H.clean(this.name)}}xt([dt.Ss.dispose()],vt.prototype,"dispose",null),function(t){t.defaultOptions=Object.assign({stencilGraphWidth:200,stencilGraphHeight:800,title:"Stencil",collapsable:!1,placeholder:"Search",notFoundText:"No matches found",layout(t,e){const i={columnWidth:this.options.stencilGraphWidth/2-10,columns:2,rowHeight:80,resizeToFit:!1,dx:10,dy:10};mt(t,Object.assign(Object.assign(Object.assign({},i),this.options.layoutOptions),e?e.layoutOptions:{}))}},gt.defaults)}(vt||(vt={})),function(t){t.base="widget-stencil",t.title=`${t.base}-title`,t.search=`${t.base}-search`,t.searchText=`${t.search}-text`,t.content=`${t.base}-content`,t.group=`${t.base}-group`,t.groupTitle=`${t.group}-title`,t.groupContent=`${t.group}-content`}(bt||(bt={})),function(t){t.defaultGroupName="__default__"}(yt||(yt={}));const wt=t=>({title:(0,ct.tc)("threatmodel.stencil.entities"),target:t,collapsable:!0,stencilGraphWidth:500,groups:[{name:"components",title:(0,ct.tc)("threatmodel.stencil.components"),collapsed:!1,collapsable:!0},{name:"boundaries",title:(0,ct.tc)("threatmodel.stencil.boundaries"),collapsed:!1,collapsable:!0},{name:"metadata",title:(0,ct.tc)("threatmodel.stencil.metadata"),collapsed:!1,collapsable:!0}],layoutOptions:{columns:1,center:!0,resizeToFit:!0}}),Ct=(t,e,i=vt)=>{const o=new i(wt(t));o.load([new lt.A.ProcessShape,new lt.A.StoreShape,new lt.A.ActorShape,new lt.A.FlowStencil],"components"),o.load([new lt.A.TrustBoundaryBox({width:160,height:75}),new lt.A.TrustBoundaryCurveStencil],"boundaries"),o.load([new lt.A.TextBlock],"metadata"),o.onSearch({target:{value:" "}}),o.onSearch({target:{value:""}}),e.appendChild(o.container)};var St={get:Ct},Tt={name:"TdGraph",components:{TdGraphButtons:m,TdGraphMeta:I,TdKeyboardShortcuts:W,TdThreatEditDialog:Y,TdThreatSuggestDialog:st},computed:(0,r.aH)({diagram:t=>t.threatmodel.selectedDiagram,providerType:t=>(0,nt.sG)(t.provider.selected)}),data(){return{graph:null}},async mounted(){this.init()},methods:{init(){this.graph=rt.A.edit(this.$refs.graph_container,this.diagram),St.get(this.graph,this.$refs.stencil_container),this.$store.dispatch(w.Ay.notModified),this.graph.getPlugin("history").on("change",(()=>{const t=Object.assign({},this.diagram);t.cells=this.graph.toJSON().cells,this.$store.dispatch(w.Ay.diagramModified,t)}))},threatSelected(t,e){this.$refs.threatEditDialog.editThreat(t,e)},threatSuggest(t){this.$refs.threatSuggestDialog.showModal(t)},saved(){console.debug("Save diagram");const t=Object.assign({},this.diagram);t.cells=this.graph.toJSON().cells,this.$store.dispatch(w.Ay.diagramSaved,t),this.$store.dispatch(w.Ay.saveModel)},async closed(){this.$store.getters.modelChanged&&!await this.getConfirmModal()||(await this.$store.dispatch(w.Ay.diagramClosed),this.$router.push({name:`${this.providerType}ThreatModel`,params:this.$route.params}))},getConfirmModal(){return this.$bvModal.msgBoxConfirm(this.$t("forms.discardMessage"),{title:this.$t("forms.discardTitle"),okVariant:"danger",okTitle:this.$t("forms.ok"),cancelTitle:this.$t("forms.cancel"),hideHeaderClose:!0,centered:!0})}},destroyed(){rt.A.dispose(this.graph)}},$t=Tt,kt=(0,u.A)($t,s,n,!1,null,"aa736afc",null),At=kt.exports,Ot={name:"DiagramEdit",components:{TdGraph:At}},Nt=Ot,Dt=(0,u.A)(Nt,o,a,!1,null,null,null),Rt=Dt.exports}}]);
//# sourceMappingURL=diagram-edit.e1a01a57.js.map